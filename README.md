# Simple Organizer
v.0.0.1  
2016-03-15  

Это пример простого web-приложения, которое может использоваться в качестве электронной телефонной книги и органайзера. Оно предназначено для сохранения номеров телефонов и имен людей, которым эти номера принадлежат,  календарь приложения позволяет сохранять короткие заметки о событиях. Приложение может быть использовано в многопользовательском окружении. Приложение разработо с использованием стека стандартов Java EE 7 и предназначено для и выполнения в среде соответсвующих серверов приложений. Работа с приложением осуществляется удаленно с использованием веб-браузеров.

### Содержание

 1. Описание приложения
 2. Использование
 3. Исходный текст
 4. Версии
 5. Отказ от гарантий
 6. Ограничение ответственности
 7. Разработчик

### 1. Описание приложения

Это пример простого web-приложения, которое может использоваться в качестве электронной телефонной книги и органайзера. Simple Organizer предназначен для сохранения номеров телефонов и имен людей, которым эти номера принадлежат,  календарь приложения позволяет сохранять короткие заметки для каждого дня. Приложение может быть использовано в многопользовательском окружении, доступ к данным предоставляется после авторизации пользователя. Для управления пользователями предусмотрена роль "ADMIN", с ее помощью производится управление пользователями т.е. добавление и удаление пользователей, управление ролями пользователя, и изменение пароля. Роль "USER" -  является основной ролью, которая обеспечивает доступ к данным пользователя. Пользователи относящиеся к роли "USER"  могут изменить свой пароль самостоятельно. Роль "GUEST" - запрещает пользователю самостоятельно изменить свой пароль.      

Авторизованные пользователи могут добавлять, изменять и удалять записи "person", которые идентифицирую владельцев телефонных номеров. Эти записи содержат два изменяемых поля: имя (first name) и фамилия (last name), записи упорядочиваются по фамилии. Этим записям может быть добавлен список телефонных номеров. Каждый номер может быть добавлен, изменен и удален. Телефонный номер имеет один атрибут, который может быть использован для его описания. Эти атрибуты могут принимать следующие значения: "DEFAULT", "WORK", "HOME". Только один телефонный номер из списка телефонных номеров персоны может обладать атрибутом "DEFAULT". Атрибуты "WORK" и "HOME" могут быть присвоены любому количеству телефонных номеров владельца номеров. Атрибуты телефонного номера могут быть сменены пользователем.

В календаре пользователь может создавать, редактировать и удалять события, которые характеризуется кратким описанием, началом и окончанием, есть возможность отметить событие как длящиеся весь день. Событие может длится непрерывную последовательность дней. Календарь позволяет рассматривать периоды в трех масштабах: "месяц", "неделя" и "день".

Работа с приложением обеспечивается с помощью веб-интерфейса, можно использовать практически любой современный графический веб-браузер, который поддерживает стандарт HTML5, для работы приложения необходимо разрешить использование "cookies"  и "Java Script". При работе с приложением необходимо использовать какое-нибудь устройство указания, например, "мышь".

В дальнейшем изложении в качестве сервера будет использоваться интернет-адрес "https://localhost:8443/", т.е. предполагается, что доступ к приложению осуществляется локально. По умолчанию предполагается, что адрес приложения на сервере это строка "organizer". Для работы с приложением можно использовать интернет-адрес "https://localhost:8443/organizer/". 

Все страницы приложения поддерживают основные элементы управления, которым является статусная строка в верху окна веб-браузера. В левой части этой строки отображается название приложения "Simple Organizer" и название компонента, с которым ведется работа. В правой части статусной строки находится кнопка "Menu". С помощью этой кнопки осуществляется доступ к меню. Элементы этого меню предназначены для выбора компонентов приложения с которым предполагается вести работу. С помощью элементов этого меню можно получить информацию о приложении и завершить с ним работу.

Для того что бы начать работу с приложением необходимо выполнить авторизацию на странице "Login". После авторизации с помощью меню осуществляется выбор компоненты приложения. Доступны следующие компоненты:

* Phone Book - телефонная книга.
* Schedule - календарь/органайзер.
* Account - управление учетной записью.
* Admin Page - управление пользователями.  

С помощью элемента меню "Logout" осуществляется выход из приложения. С помощью элемента меню "About" можно получить краткую информацию о приложении. С помощью элемента меню "Help" можно получит краткую справочную информацию.

В том случае, если возникли проблемы при работе с приложением, то основным восстанавливающим циклом является выход из приложения с использованием элемента меню "Logout", после этого должна появиться страница "Logout" и затем перехода по ссылке "Login page", которая  находится на этой странице.


### 1.1. Phone Book - телефонная книга.

Компонент "Phone Book" - состоит из следующих страниц: Таблица владельцев телефонов; Подробная информация; Редактирование; Добавление; Удаление.  
На странице  "Таблица владельцев телефонов" выводится таблица в которой содержаться имена и фамилии владельцев телефонов и номер телефона, который имеет аттрибут "DEFAULT". Строки таблицы могут быть выбраны для просмотра, редактирования и удаления. Выбор действия определяется с помощью кнопок находящихся под таблицей. Этими кнопками являются следующие кнопки:  
* "View"
* "Edit"
* "Add"
* "Delete"

Кнопка "Add" доступна для использования всегда. Остальные кнопки можно использовать только после выбора владельца телефонного номера в таблице.

1.1.1. С помощью кнопки "View" можно перейти на страницу, на которую выводится подробная информация о владельце номеров телефонов. На этой странице выводится имя и фамилия владельца номеров и таблица со всеми номерами принадлежащими этому владельцу. В низу страницы находится кнопка "Return", с помощью которой, производится возврат к "Таблице владельцев телефонов".

1.1.2. С помощью кнопки "Edit" производится переход на страницу редактирования данных владельца телефонного номера. Эта страница позволяет редактировать следующие данные: имя и фамилия владельца номеров, телефонные номера и атрибут телефонного номера. Страница разделена на следущие области: область редактирования имени и фамилии владельца номеров; область добавления номера телефона; таблица номеров телефонов.  
В области редактирования имени и фамилии владельца номеров находятся два поля ввода в которых можно редактировать соответствующие данные.  
В области добавления телефонного номера находится поле ввода телефонного номера, меню выбора аттрибута телефонного номера и кнопка "Add phone". Телефонный номер будет добавлен к списку номеров телефонов только после нажания на кнопку "Add Phone".  
Таблица телефонных номеров состоит из четырех столбцев: порядковый номер строки; столбец с полями редактирования номера; столбец с кнопкой выбора аттрибута номера; столбец с кнопками "Delete Phone". После нажатия на кнопку "Delete Phone" будет удалена строка из таблицы и будут удалены данные находящиеся в этой строке.   
В низу страницы находятся следующие кнопки: "Save"; "Return" и "Revert". С помощью кнопки "Save" сохраняются данные. С помощью кнопки "Return"  производится возврат на страницу "Таблица владельцев телефонов". С помощью кнопки "Revert" выполняется восстановление исходных значений, которые имели поля формы до начала редактирования. 

1.1.3. С помощью кнопки "Add" производится переход на страницу, которая предназначена для добавления нового владельца телефонного номера. Эта страница по своиму внешнему виду и своим возможностям полностью эквивалентна странице "Edit".

1.1.4. С помощью кнопки "Delete" производится переход на страницу удаления информации о владельце телефонного номера и его телефонных номеров. Эта страница по своему содержанию эквивалентна странице "View". В низу страницы находятся следующие кнопки: "Delete"  и "Return". С помощью кнопки "Delete" производтся удаление данных. С помощью кнопки "Return" производится возврат на страницу "Таблица владельцев телефонов".


### 1.2. Schedule - календарь/органайзер.

Компонент Schedule - календарь/органайзер, предназначена для работы с заметками, которые привязаны к календарным датам. Эти события могут иметь практически неограниченную продолжительность. К одной календарной дате может быть привязано множество событий.  
Страница разделена на следующие области: область календаря и область события. В области календаря выводится календарь в различных форматах, кнопки управления отображаемого периода и кнопки управления отображения календаря.  Кнопки управления отображаемого периода находяся в левой верхней части области и представлены следующими кнопками: стрелка назад, стрелка вперед и кнопка "Current Date". Стрелки назад и вперед управляют переходом между отображаемыми дискретами времени. Кнопка "Current Date" производит отображение дискрета времени в котором находится текущая дата.  
Кнопки управления отображением календаря находятся в правой верхней части области и представлены следующими кнопками: "Month", "week", "Day". Эти кнопки управляют выбором отображаемого дискрета времени. Кнопка "Month" производит выбор дискрета "месяц", для этого варианта в области календаря отображается таблица в ячейках, которой выводятся даты месяца. С помощью кнопки "week" производится отображение дискрета "неделя". С помощью кнопки "Day" производится отображение дискрета "сутки".  
В области событий находится форма, которая позволяет ввести название события, даты начала и окончания события, чек-бокс указывающий, что событие продлится весь день. В этой области находятся кнопки "Reset"  и "Save". С помощью кнопки "Save "  производится сохранение созданного события, с помощью кнопки "Reset" производится сброс полей формы к исходному значению.

### 1.3. Account - управление учетной записью.

Компонент "Account" предназначена для управления пользователем своей учетной записью.  Эта страница разделена на следующие области: область идентификатора учетной записи "Username"; область ролей "Groups"; область пароля "Password". В области "Username" выводится имя, под которым пользователь зарегистрирован в системе. В области ролей выводится список ролей, которыми обладает пользователь, в области "Password" находятся два поля и кнопки "Reset" и "Change password" для изменения пароля. Для изменения пароля необходимо в области "Password" ввести пароль в поля "Type password" и "Retype password", и нажать кнопку "Change Password". Нажатие на кнопку "Reset" очищает поля "Type password" и "Retype password".


### 1.4. Admin Page - управление пользователями.

Компонент "Admin Page" - управление пользователями предназначен для управления пользователями. С помощью этого компонента производится добавление и удаление пользователей, изменение пароля пользователей, изменение списка ролей которыми обладает пользователь. Этот компонент состоит из следующих страниц: 
* "Admin Page"
* "Edit User"
* "Add User"
* "Delete User"

1.4.1. На странице "Admin Page" выводится таблица содержащая идентификаторы учетных записей пользователей и списки групп, которыми эти пользователи обладают. В низу страницы находятся следующие кнопки:  "Edit"; "Add" и "Delete". С помощью кнопки "Edit" производится переход на страницу изменения учетной записи. С помощью кнопки "Add" производится переход на страницу добавления учетной записи. С помощью кнопки "Delete" производится переход на страницу удаления учетной записи. Кнопка "Add" доступна всегда. Кнопки "Edit" и "Delete" доступны только после выбора учетной записи в таблице учетных записей.

1.4.2. На странице "Edit User" производится редактирование учетной записи пользователя. Эта страница состоит из следующих областей: область "Username"; область "Groups" и область "Password", в низу страницы находится кнопка "Return". Эта кнопка предназначена для возврата на страницу "Admin Page". В области "Username" выводится идентификатор учетной записи пользователя. В области "Groups" выводится список ролей которые доступны в приложении и там-же расположены кнопки "Reset", и "Change Groups". Роли, которыми обладает пользователь отмечены галочкой в соответсвующих чек-боксах, изменяя состояния чек-боксов можно изменить список ролей, которыми обладает пользователей. Для сохранения изменений в списке ролей необходимо нажать на клавишу "Change Groups". Кнопка "Reset" возвращает начальное состояние списка. Область "Password" предназначена для изменения пароля. В области "Password" находятся два поля и кнопки "Reset" и "Change password" для изменения пароля. Для изменения пароля необходимо в области "Password" ввести пароль в поля "Type password" и "Retype password", и нажать кнопку "Change Password". Нажатие на кнопку "Reset" очищает поля "Type password" и "Retype password".

1.4.3. На странице "Add User" производится добавление учетной записи. Эта страница состоит из следующих областей: область "Username"; область "Groups" и область "Password", в низу страницы находится кнопки "Save" и "Return". Кнопка "Save" сохраняет вновь созданную учетную запись. Кнопка "Return" предназначена для возврата на страницу "Admin Page". В области "Username" в поле ввода вводится идентификатор учетной записи пользователя.  В области "Groups" выводится список ролей которые доступны в приложении. Роли, которыми будет обладать пользователь должны быть отмечены галочками в соответсвующих чек-боксах, изменяя состояния чек-боксов можно изменить список ролей, которыми обладает пользователей. Область "Password" предназначена для изменения пароля. В области "Password" находятся два поля. Для установления пароля необходимо в области "Password" ввести пароль в поля "Type password" и "Retype password".

1.4.4. На странице "Delete User" производится удаление учетной записи. Эта страница состоит из следующих областей: область "Username" и область "Groups", в низу страницы находится кнопки "Delete" и "Return". Кнопка "Delete" удаляет  учетную запись. Кнопка "Return" предназначена для возврата на страницу "Admin Page". В области "Username" выводится идентификатор учетной записи пользователя. В области "Groups" выводится список ролей которыми обладает пользователь.


### 2. Использование

2.1. Приложение предназначено для работы в среде серверов приложений, которые соответствуют спецификации Java EE 7. Приложение разрабатывалось в среде сервера приложений типа "WildFly v. 9.0.2.Final".  
2.2. Сервер приложений должен иметь доступ к базе данных с JNDI идентификатором "java:/simpleorganizer". При разработке приложения, в качестве базы данных мспользовалась база данных типа  "MySQL Community Server (GPL) v. 5.7.11".   
В качестве примера, ниже приведен фрагмент файла конфигурации (standalone.xml), относящийся к источнику данных, для сервера приложений типа "WildFly 9.0.2.Final".
<pre>
&lt;datasource jta="true" jndi-name="java:/simpleorganizer" pool-name="simpleorganizer" enabled="true" use-ccm="true" statistics-enabled="true"&gt;
    &lt;connection-url&gt;jdbc:mysql://localhost:3306/simpleorganizer&lt;/connection-url&gt;
    &lt;driver-class&gt;com.mysql.jdbc.Driver&lt;/driver-class&gt;
    &lt;driver&gt;mysql-connector-java-5.1.38-bin.jar_com.mysql.jdbc.Driver_5_1&lt;/driver&gt;
    &lt;pool&gt;
        &lt;allow-multiple-users&gt;true&lt;/allow-multiple-users&gt;
    &lt;/pool&gt;
    &lt;security&gt;
        &lt;user-name&gt;simpleorganizer&lt;/user-name&gt;
        &lt;password&gt;simpleorganizer&lt;/password&gt;
    &lt;/security&gt;
    &lt;validation&gt;
        &lt;valid-connection-checker class-name="org.jboss.jca.adapters.jdbc.extensions.mysql.MySQLValidConnectionChecker"/&gt;
        &lt;background-validation&gt;true&lt;/background-validation&gt;
        &lt;exception-sorter class-name="org.jboss.jca.adapters.jdbc.extensions.mysql.MySQLExceptionSorter"/&gt;
    &lt;/validation&gt;
&lt;/datasource&gt;
</pre>

2.3. Приложение использует стандартную для серверов приложений систему разграничения доступа, так называемую form-based авторизацию. В базе данных хранится, преобразованный по алгоритму "base64" в символьный вид, хэш паролей. Этот хэш вычисляется по алгоритму "SHA-256". В качестве основы для реализации использовалась статья "JDBC Realm and Form Based Authentication with WildFly 8.2.0.Final, Primefaces 5.1 and MySQL 5 by Markus Eisele", размещенная по адресу: "https://dzone.com/articles/jdbc-realm-and-form-based-0".

Ниже приведены структуры таблиц с необходимой для авторизации информацией.  
Таблица идентификаторов учетных записей и паролей, имя таблицы: "user":
<pre>
    
CREATE TABLE `user` (
    `id` bigint(20) NOT NULL,
    `passwd` varchar(255) DEFAULT NULL,
    `username` varchar(255) NOT NULL,
    PRIMARY KEY (`id`),
    UNIQUE KEY `UK_username` (`username`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 
</pre>
    
Таблица ролей которыми обладают пользователи, имя таблицы "user_groups":
    
<pre>
CREATE TABLE `user_groups` (
    `user_id` bigint(20) NOT NULL,
    `user_group` varchar(255) DEFAULT NULL,
    KEY `FK_user_id` (`user_id`),
    CONSTRAINT `FK_user_user_id` FOREIGN KEY (`user_id`) REFERENCES `user` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 
</pre>
    
В качестве примера, ниже приведен фрагмент файла конфигурации (standalone.xml), относящийся к авторизации, для сервера приложений типа "WildFly 9.0.2.Final".
<pre>
&lt;security-domain name="simpleorganizerSecureDomain" cache-type="default"&gt;
    &lt;authentication&gt;
        &lt;login-module code="Database" flag="required"&gt;
            &lt;module-option name="dsJndiName" value="java:/simpleorganizer"/&gt;
            &lt;module-option name="principalsQuery" value="select passwd from user where username=?"/&gt;
            &lt;module-option name="rolesQuery" value="select user_group, 'Roles' from user left join user_groups on user.id = user_groups.user_id where user.username=?"/&gt;
            &lt;module-option name="hashAlgorithm" value="SHA-256"/&gt;
            &lt;module-option name="hashEncoding" value="base64"/&gt;
        &lt;/login-module&gt;
    &lt;/authentication&gt;
&lt;/security-domain&gt;
</pre>

2.4. Приложение состоит из двух загружаемых на сервер приложений модулей: "organizer.war" и "dbinit.war". "organizer.war" - это основное приложение, которое реалезует заданный функционал. "dbinit.war" - это вспомогательное приложение, которое может использоваться для автоматизированного создания схемы в базе данных. Это приложение не должно запускаться в таком окружении, в котором целевая схема уже создана, результаты такого повторного запуска непредсказуемы. Для автоматизированного создания схемы базы данных с помощью модуля "dbinit.war"  необходимо, в среде сервера приложений, создать источник данных с JNDI-именем "java:/simpleorganizer". В этом источнике не должно быть ни одной схемы. После этого необходимо загрузить модуль "dbinit.war" на сервер приложений. Протокол создания приложений выводится в лог-файл. Результат работы можно проверить по адресу "http://localhost:8080/dbinit/". На странице по этому адресу должны быть выведены две строки: В первой выводится имя и версия модуля, например:
    
    dbinit version: 0.0.1
        
Во второй строке выводится результат проверки созданной схемы, например так:  
     
    schema generation result: success  
      
при успешном создании схемы и  
     
    schema generation result: fail
      
при неудаче. Независимо от результатов работы модуля его необходимо принудительно выгрузить из сервера базы данных. Результаты совместной загрузки или нахождения на одном сервере приложений модулей "organizer.war" и "dbinit.war" непредсказуемы.

2.5. Основным загружаемым модулем приложения является модуль "organizer.war". Интернет адрес приложения можно представить в следующем виде: "https://localhost:8443/organizer/". Имя хоста "localhost" должно быть заменено на доменное имя того хоста, на котором будет установлено приложение.

### 3. Исходный текст
Программа в виде исходных текстов, исполняемого кода и описания распространяется на условиях LGPL v3.

### 4. Версии
0.0.1-SNAPSHOT от 2016-03-15

### 5. Отказ от гарантий

НЕТ НИКАКИХ ГАРАНТИЙ ДЛЯ ПРОГРАММЫ ДО РАМОК, ДОПУСТИМЫХ ДЕЙСТВУЮЩИМ
ЗАКОНОДАТЕЛЬСТВОМ. ЕСЛИ ИНОЕ НЕ УСТАНОВЛЕНО В ПИСЬМЕННОЙ ФОРМЕ, ПРАВООБЛАДАТЕЛЬ
И/ИЛИ ДРУГИЕ СТОРОНЫ ПРЕДОСТАВЛЯЮТ ПРОГРАММУ «КАК ЕСТЬ», БЕЗ КАКИХ ЛИБО ГАРАНТИЙ
(ЗАЯВЛЕННЫХ ИЛИ ПОДРАЗУМЕВАЕМЫХ), ВКЛЮЧАЯ, НО, НЕ ОГРАНИЧИВАЯСЬ,
ПОДРАЗУМЕВАЕМЫМИ ГАРАНТИЯМИ ТОВАРНОГО СОСТОЯНИЯ ПРИ ПРОДАЖЕ И ГОДНОСТИ ДЛЯ
ОПРЕДЕЛЕННОГО ПРИМЕНЕНИЯ. ВЕСЬ РИСК, КАК В ОТНОШЕНИИ КАЧЕСТВА, ТАК И
ПРОИЗВОДИТЕЛЬНОСТИ ПРОГРАММЫ ВЫ БЕРЕТЕ НА СЕБЯ. ЕСЛИ В ПРОГРАММЕ ОБНАРУЖЕН
ДЕФЕКТ, ВЫ БЕРЕТЕ НА СЕБЯ СТОИМОСТЬ НЕОБХОДИМОГО ОБСЛУЖИВАНИЯ, ПОЧИНКИ ИЛИ
ИСПРАВЛЕНИЯ.

### 6. Ограничение ответственности

НИ В КОЕМ СЛУЧАЕ, ЕСЛИ НЕ ТРЕБУЕТСЯ ПРИМЕНИМЫМ ЗАКОНОМ ИЛИ ПИСЬМЕННЫМ
СОГЛАШЕНИЕМ, НИ ОДИН ИЗ ПРАВООБЛАДАТЕЛЕЙ ИЛИ СТОРОН, ИЗМЕНЯВШИХ И/ИЛИ
ПЕРЕДАВАВШИХ ПРОГРАММУ, КАК БЫЛО РАЗРЕШЕНО ВЫШЕ, НЕ ОТВЕТСТВЕНЕН ЗА УЩЕРБ,
ВКЛЮЧАЯ ОБЩИЙ, КОНКРЕТНЫЙ, СЛУЧАЙНЫЙ ИЛИ ПОСЛЕДОВАВШИЙ УЩЕРБ, ВЫТЕКАЮЩИЙ ИЗ
ИСПОЛЬЗОВАНИЯ ИЛИ НЕВОЗМОЖНОСТИ ИСПОЛЬЗОВАНИЯ ПРОГРАММЫ (ВКЛЮЧАЯ, НО, НЕ
ОГРАНИЧИВАЯСЬ ПОТЕРЕЙ ДАННЫХ ИЛИ НЕВЕРНОЙ ОБРАБОТКОЙ ДАННЫХ, ИЛИ ПОТЕРИ,
УСТАНОВЛЕННЫЕ ВАМИ ИЛИ ТРЕТЬИМИ ЛИЦАМИ, ИЛИ НЕВОЗМОЖНОСТЬ ПРОГРАММЫ РАБОТАТЬ С
ДРУГИМИ ПРОГРАММАМИ), ДАЖЕ В СЛУЧАЕ ЕСЛИ ПРАВООБЛАДАТЕЛЬ ЛИБО ДРУГАЯ СТОРОНА
БЫЛА ИЗВЕЩЕНА О ВОЗМОЖНОСТИ ТАКОГО УЩЕРБА.

### 7. Разработчик

Николай Кирдин

email: nkirdin@gmail.com

©Nikolay Kirdin, 2016



